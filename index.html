<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>巴西电子管理系统</title>
    <link
      rel="icon"
      href="https://raw.githubusercontent.com/mubai16888/mb/main/mb.ico"
      type="image/x-icon"
    />
    <link
      rel="stylesheet"
      href="https://unpkg.com/perfect-scrollbar@1.5.0/css/perfect-scrollbar.css"
    />
    <script src="https://unpkg.com/perfect-scrollbar@1.5.0/dist/perfect-scrollbar.min.js"></script>

    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      html,
      body {
        height: 100%;
        font-family: "Segoe UI", sans-serif;
        overflow: hidden;
        background-color: #f0f2f5;
      }

      /* 导航栏 - 提高层级，防止被下方遮挡 */
      .tab-buttons {
        display: flex;
        align-items: center;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 36px;
        background-color: #ffffff;
        z-index: 2000;
        border-bottom: 1px solid #ddd;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        pointer-events: auto; /* 确保导航栏本身可点击 */
      }

      .tab-buttons button {
        padding: 6px 15px;
        border: none;
        background: none;
        cursor: pointer;
        font-size: 14px;
        color: #333;
        transition: all 0.3s;
      }

      .tab-buttons button.active {
        background: linear-gradient(135deg, #4e8efb, #a777e3);
        color: #fff;
        font-weight: bold;
      }

      /* 内容容器 */
      .content {
        width: 100%;
        position: absolute;
        top: 36px;
        bottom: 0;
        left: 0;
        right: 0;
        padding: 5px;
        z-index: 1;
        pointer-events: none; /* 容器本身不拦截事件，让事件穿透到内部激活的 section */
      }

      /* 单个页面容器 - 关键样式修改 */
      .section {
        width: 100%;
        height: 100%;
        position: absolute;
        top: 0;
        left: 0;
        visibility: hidden;
        opacity: 0;
        z-index: 0;
        pointer-events: none; /* 隐藏时彻底禁止点击，防止遮挡 */
        transition: opacity 0.3s ease;
        border-radius: 4px;
        overflow: hidden;
      }

      /* 激活页面容器 - 关键样式修改 */
      .section.active-section {
        visibility: visible;
        opacity: 1;
        z-index: 100; /* 置顶 */
        pointer-events: auto; /* 只有激活的页面允许点击 */
      }

      iframe {
        width: 100%;
        height: 100%;
        border: none;
      }

      /* 刷新按钮 */
      .refresh-btn {
        margin-left: auto;
        margin-right: 10px;
        cursor: pointer;
        color: #4e8efb;
      }

      .toast {
        position: fixed;
        top: 50px;
        right: 20px;
        background: rgba(0, 0, 0, 0.7);
        color: white;
        padding: 8px 15px;
        border-radius: 5px;
        z-index: 3000;
        opacity: 0;
        transition: 0.3s;
        pointer-events: none;
      }
      .toast.show {
        opacity: 1;
      }
    </style>
  </head>
  <body>
    <div class="toast" id="toast"></div>
    <div class="tabs">
      <div class="tab-buttons" id="tabButtons">
        <button class="refresh-btn" id="refreshBtn">刷新</button>
      </div>
      <div class="content" id="contentContainer"></div>
    </div>

    <script>
      const pages = [
        {
          id: "section1",
          src: "./main.html",
          titleFallback: "读取TXT文件",
        },
        { id: "section2", src: "./readerText.html", titleFallback: "读取TXT" },
        { id: "section3", src: "./Risk.html", titleFallback: "风控教程" },
        { id: "section4", src: "./staff.html", titleFallback: "人员表" },
        { id: "section5", src: "./exchange.html", titleFallback: "汇率表" },
        { id: "section6", src: "./messages.html", titleFallback: "站内信" },
        { id: "section7", src: "./planning.html", titleFallback: "每日规划" },
      ];

      const contentContainer = document.getElementById("contentContainer");
      const tabButtonsContainer = document.getElementById("tabButtons");
      const refreshBtn = document.getElementById("refreshBtn");
      let currentIndex = 0;

      // 初始化页面
      pages.forEach((page, index) => {
        const section = document.createElement("div");
        section.id = page.id;
        section.className = "section";
        const iframe = document.createElement("iframe");
        iframe.src = page.src;
        iframe.id = "iframe" + index;
        section.appendChild(iframe);
        contentContainer.appendChild(section);

        const btn = document.createElement("button");
        btn.textContent = page.titleFallback;
        btn.addEventListener("click", () => switchToTab(index));
        tabButtonsContainer.insertBefore(btn, refreshBtn);
      });

      // 核心函数：切换标签
      function switchToTab(index) {
        if (index === currentIndex) return;

        // 1. 处理【旧页面】：禁用点击，降低层级
        const prevSection = document.getElementById(pages[currentIndex].id);
        if (prevSection) {
          prevSection.classList.remove("active-section");
          prevSection.style.pointerEvents = "none";
          prevSection.style.zIndex = "0";
        }
        tabButtonsContainer.children[currentIndex].classList.remove("active");

        // 更新当前索引
        currentIndex = index;

        // 2. 处理【新页面】：启用点击，强制置顶
        const activeSection = document.getElementById(pages[currentIndex].id);
        if (activeSection) {
          activeSection.classList.add("active-section");
          activeSection.style.pointerEvents = "auto";
          activeSection.style.zIndex = "100"; // 确保他在最前面
        }
        tabButtonsContainer.children[currentIndex].classList.add("active");

        showToast("已切换到：" + pages[currentIndex].titleFallback);
        document.title = pages[currentIndex].titleFallback;
      }

      function showToast(msg) {
        const t = document.getElementById("toast");
        t.textContent = msg;
        t.classList.add("show");
        setTimeout(() => t.classList.remove("show"), 1500);
      }

      refreshBtn.onclick = () => {
        const iframe = document.getElementById("iframe" + currentIndex);
        if (iframe) iframe.src = iframe.src;
        showToast("正在刷新页面...");
      };

      // 默认打开第一个
      const firstSection = document.getElementById(pages[0].id);
      firstSection.classList.add("active-section");
      firstSection.style.pointerEvents = "auto";
      tabButtonsContainer.children[0].classList.add("active");
    </script>
  </body>
</html>
